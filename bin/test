#!/usr/bin/env bash

set -eo pipefail

mkdir -p tmp/

cd tmp
rm -rf test_tmpl

rails new test_tmpl -m ../template.rb

cd test_tmpl

git add .
git commit -m 'Initial Commit'

bin/tools-setup
bin/tools-upgrade

echo "class Test;end" > test.rb

git add .
git commit -m 'Verification class'

bin/rubocop --fail-level F test.rb
bin/pronto run -c HEAD~1

hash circleci 2>/dev/null || curl -fLSs https://circle.ci/cli | bash
circleci config validate
